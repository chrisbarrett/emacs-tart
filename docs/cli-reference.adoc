= tart(1) CLI Reference
:toc: left
:toclevels: 2
:source-highlighter: rouge

== Name

tart - A type checker for Emacs Lisp

== Synopsis

[verse]
*tart* [_OPTIONS_] _FILE_ [_FILES_...]
*tart* *eval* _EXPR_
*tart* *expand* [*--load* _FILE_]... _FILE_
*tart* *repl*
*tart* *lsp* [*--port* _PORT_] [*--log-level* _LEVEL_]

== Description

Tart is a static type checker for Emacs Lisp. It reads type declarations from
`.tart` files and verifies that `.el` implementations match their declared
interfaces.

When invoked with one or more files, Tart type-checks them in order, with
definitions from earlier files visible to later files.

== Commands

=== Default: Type Check

[source,bash]
----
tart FILE [FILES...]
----

Type-check one or more Emacs Lisp files. If a `.el` file has a sibling `.tart`
file, the implementation is verified against the declared signatures.

Files are processed in order. Definitions from earlier files are available when
type-checking later files.

*Examples:*

[source,bash]
----
# Check a single file
tart my-lib.el

# Check multiple files in order
tart my-lib.el my-lib-tests.el

# Check all Elisp files in a directory
tart *.el
----

=== eval

[source,bash]
----
tart eval EXPR
----

Evaluate an S-expression and print the result with its type.

The expression is parsed, evaluated in Tart's interpreter, and type-checked. The
output format is `VALUE :: TYPE`.

*Examples:*

[source,bash]
----
$ tart eval '(+ 1 2)'
3 :: Int

$ tart eval '(concat "hello" " world")'
"hello world" :: String

$ tart eval '(mapcar (lambda (x) (* x 2)) (list 1 2 3))'
(2 4 6) :: (List Int)
----

=== expand

[source,bash]
----
tart expand [--load FILE]... FILE
----

Macro-expand the specified file and print the result.

Macros can be loaded from additional files using the `--load` option. This is
useful for expanding files that depend on custom macros.

*Options:*

*--load* _FILE_::
  Load macro definitions from _FILE_ before expanding. This option may be
  repeated to load multiple files.

*Examples:*

[source,bash]
----
# Expand a file
tart expand my-lib.el

# Load macros first
tart expand --load my-macros.el my-lib.el

# Load multiple macro files
tart expand --load macros1.el --load macros2.el main.el
----

=== repl

[source,bash]
----
tart repl
----

Start an interactive read-eval-print loop. Expressions are evaluated and
type-checked, with results displayed as `VALUE :: TYPE`.

*REPL Commands:*

The REPL supports special commands prefixed with `,`:

[cols="1,3"]
|===
|Command |Description

|`,quit`, `,q`
|Exit the REPL

|`,type` _EXPR_
|Show the type of an expression without evaluating it

|`,expand` _EXPR_
|Show the macro expansion of an expression

|`,env`
|List current bindings (values and macros)

|`,help`
|Show available commands
|===

*Multi-line Input:*

The REPL automatically detects incomplete input (unbalanced parentheses) and
prompts for continuation:

[source]
----
tart> (defun add-one (x)
... >   (+ x 1))
add-one :: ((Int) -> Int)
----

*Examples:*

[source]
----
$ tart repl
tart 0.1.0 REPL
Type ,help for commands, ,quit to exit.

tart> (+ 1 2)
3 :: Int
tart> ,type (mapcar (lambda (x) x) '(1 2 3))
(List Int)
tart> ,expand (when t "yes")
(if t (progn "yes"))
tart> ,quit
----

=== lsp

[source,bash]
----
tart lsp [--port PORT] [--log-level LEVEL]
----

Start the Language Server Protocol (LSP) server for editor integration.

By default, the server communicates over stdio. Use `--port` to listen on a TCP
port instead.

*Options:*

*--port* _PORT_::
  Listen on TCP port _PORT_ instead of stdio. The server accepts one client
  connection.

*--log-level* _LEVEL_::
  Set the logging level. Valid values:
  * `debug` - Verbose output including LSP messages
  * `normal` - Standard logging (default)
  * `quiet` - Minimal output

*LSP Capabilities:*

The server provides:

* `textDocument/publishDiagnostics` - Real-time type errors and warnings
* `textDocument/hover` - Type information on hover
* `textDocument/definition` - Go to definition
* `textDocument/references` - Find all references
* `textDocument/completion` - Auto-completion with type info
* `textDocument/signatureHelp` - Function signature hints
* `textDocument/rename` - Symbol renaming
* `textDocument/codeAction` - Quick fixes and refactorings
* `textDocument/documentSymbol` - Document outline

*Examples:*

[source,bash]
----
# Stdio mode (for most editors)
tart lsp

# TCP mode for debugging
tart lsp --port 9000

# Verbose logging
tart lsp --log-level debug
----

== Global Options

*--help*, *-h*::
  Print usage information and exit.

*--version*, *-v*::
  Print version information and exit.

== Exit Codes

[cols="1,3"]
|===
|Code |Meaning

|0
|Success. All type checks passed.

|1
|Error in input. A parse error, type error, or evaluation error occurred.

|2
|Usage error. Invalid command-line arguments.
|===

== Environment

=== Search Path

Tart searches for `.tart` files in the following order:

1. *Sibling file* - A `.tart` file next to the `.el` file being checked
2. *Search path directories* - Configurable via LSP or CLI
3. *Bundled stdlib* - Built-in signatures for Emacs primitives

When `(require 'foo)` is encountered, Tart looks for `foo.tart` in these
locations.

=== Stdlib

Tart includes type signatures for common Emacs libraries:

* `builtins` - Arithmetic, list operations, string functions, predicates
* `cl-lib` - Common Lisp compatibility functions
* `seq` - Sequence operations
* `dash` - List manipulation (dash.el)
* `s` - String manipulation (s.el)
* `f` - File operations (f.el)
* `ht` - Hash tables (ht.el)
* `map` - Generic map operations
* `subr-x` - Extra subroutines
* `buffers`, `windows`, `frames`, `files` - Emacs core APIs

== Files

`~/.tart/`::
  User configuration directory (reserved for future use).

`*.tart`::
  Type declaration files. By convention, placed alongside `.el` files.

`*.el`::
  Emacs Lisp source files to type-check.

== Examples

=== Type-Check a Project

[source,bash]
----
# Check all Elisp files
tart *.el

# Check with verbose errors
tart my-package.el 2>&1 | less
----

=== Explore Types Interactively

[source,bash]
----
$ tart repl
tart> ,type (car '(1 2 3))
Int
tart> ,type (cdr '(1 2 3))
(List Int)
tart> ,type mapcar
(((a) -> b) (List a)) -> (List b)
----

=== Integrate with CI

[source,bash]
----
#!/bin/bash
# Exit on first error
set -e

# Type-check all source files
tart src/*.el

echo "Type check passed!"
----

=== Debug Macro Expansion

[source,bash]
----
# See what (when pred body) expands to
tart eval '(macroexpand-1 (quote (when t "yes")))'

# Or use expand command with context
tart expand --load my-macros.el my-code.el
----

== See Also

* link:getting-started.adoc[Getting Started] - Tutorial for new users
* link:library-authors.adoc[Library Authors Guide] - Writing `.tart` files
* link:tooling-setup.adoc[Tooling Setup] - Editor configuration

== Version

This document describes tart version 0.1.0.
